<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>E-Learning-System</title>
    <meta name="description" content="这是一个 index 页面">
    <meta name="keywords" content="index">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="renderer" content="webkit">
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <link rel="icon" type="image/png" href="../static/assets/i/logo.png">
    <link rel="apple-touch-icon-precomposed" href="../static/assets/i/app-icon72x72@2x.png">
    <meta name="apple-mobile-web-app-title" content="Amaze UI" />
    <link rel="stylesheet" href="../static/assets/css/amazeui.min.css" />
    <link rel="stylesheet" href="../static/assets/css/amazeui.datatables.min.css" />
    <link rel="stylesheet" href="../static/assets/css/app.css">
    <script src="../static/assets/js/jquery.min.js"></script>

</head>

<body data-type="widgets">
<script src="../static/assets/js/theme.js"></script>
<div class="am-g tpl-g">
    <!-- 头部 -->
    <header>
        <!-- logo -->
        <div class="am-fl tpl-header-logo">
            <a href="javascript:;"><img src="../static/assets/img/logo_s.png" alt=""></a>
        </div>
        <!-- 右侧内容 -->
        <div class="tpl-header-fluid">
            <!-- 侧边切换 -->
            <div class="am-fl tpl-header-switch-button am-icon-list">
                    <span>

                </span>
            </div>

            <!-- 其它功能-->
            <div class="am-fr tpl-header-navbar">
                <ul>
                    <!-- 欢迎语 -->
                    <li class="am-text-sm tpl-header-navbar-welcome">
                        <a href="/info">欢迎你, <span id="user-name-r"> 访客</span> </a>
                    </li>





                    <!-- 退出 -->
                    <li class="am-text-sm">
                        <a href="javascript:;" onclick="quit()">
                            <span class="am-icon-sign-out"></span> 退出
                        </a>
                    </li>
                </ul>
            </div>
        </div>

    </header>
    <!-- 风格切换 -->
    <div class="tpl-skiner">
        <div class="tpl-skiner-toggle am-icon-cog">
        </div>
        <div class="tpl-skiner-content">
            <div class="tpl-skiner-content-title">
                选择主题
            </div>
            <div class="tpl-skiner-content-bar">
                <span class="skiner-color skiner-white" data-color="theme-white"></span>
                <span class="skiner-color skiner-black" data-color="theme-black"></span>
            </div>
        </div>
    </div>
    <!-- 侧边导航栏 -->
    <div class="left-sidebar">



        <!-- 菜单 -->
        <ul class="sidebar-nav">
            <li class="sidebar-nav-link">
                <a href="table-list.html"  >
                    <i class="am-icon-home sidebar-nav-link-logo"></i> 资源列表
                </a>
            </li>
            <li class="sidebar-nav-link">
                <a >
                    <i class=" sidebar-nav-link-logo"></i>
                </a>
            </li>
            <li class="sidebar-nav-link">
                <a href="table-list.html"  >
                    <i class="am-icon-home sidebar-nav-link-logo"></i> 资源列表
                </a>
            </li>
            <li class="sidebar-nav-link" >
                <a href="table-list-img.html" >
                    <i class="am-icon-table sidebar-nav-link-logo"></i> 学生中心
                </a>
            </li>

            <li class="sidebar-nav-link" >
                <a href="liuyanban.html"  class="active">
                    <i class="am-icon-pencil sidebar-nav-link-logo"></i> 留言板
                </a>
            </li>

            <li class="sidebar-nav-link">
                <a href="calendar.html">
                    <i class="am-icon-calendar sidebar-nav-link-logo"></i> 课程时间
                </a>
            </li>
            <li class="sidebar-nav-link">
                <a href="form.html">
                    <i class="am-icon-wpforms sidebar-nav-link-logo"></i> 课程简介

                </a>
            </li>




        </ul>
    </div>






    <!-- 内容区域 -->
    <div class="tpl-content-wrapper">
        <div class="row-content am-cf">
            <div class="row">
                <div class="am-u-sm-12 am-u-md-12 am-u-lg-12">
                    <div class="widget am-cf">
                        <div class="widget-head am-cf">
                            <div class="widget-title  am-cf">留言板</div>


                        </div>
                        <div class="widget-body  am-fr">
                            <div class="am-u-sm-12 am-u-md-12 am-u-lg-3">
                                <div class="am-input-group am-input-group-sm tpl-form-border-form cl-p">
                                    <input type="text" class="am-form-field "  id="myInput"  placeholder="输入您的留言...">

                                    <span class="am-input-group-btn">
            <button class="am-btn  am-btn-default am-btn-success tpl-table-list-field am-icon-plus" type="button" onclick="searchfunc()">发布留言</button>
          </span>
                                </div>

                            </div>

                            <div class="am-u-sm-12">

                                <script type="text/javascript">


                                    function searchfunc() {


                                        var a = getCookie2("id")
                                        var input = document.getElementById("myInput");
                                        var filter = input.value.trim();


                                        jQuery.ajax({
                                            type:"post",//后面用","很容易出错
                                            url:"/addLiuyan",//删除的控制器url
                                            data:{id:a , liuyan:filter},//做传递的参数
                                            success:function(data){//成功后执行的方法
                                                alert(data)
                                                window.location.reload();
                                            },
                                            error:function(){//失败后执行的方法

                                            }
                                        })

                                    }


                                    function uploadscore(t){

                                        var x = prompt ("请输入回复内容: ", "");/*第一个变量为提示语，第二个变量为默认初始值*/

                                        var a = $(t).attr("studentid")



                                        jQuery.ajax({
                                            type:"post",//后面用","很容易出错
                                            url:"/addReply",//删除的控制器url
                                            data:{id:a , reply:x},//做传递的参数
                                            success:function(data){//成功后执行的方法
                                                alert(data)
                                                window.location.reload();
                                            },
                                            error:function(){//失败后执行的方法

                                            }
                                        })
                                    }

                                    function del(t){
                                        var a = $(t).attr("studentid")
                                        jQuery.ajax({
                                            type:"post",//后面用","很容易出错
                                            url:"/deleteReply",//删除的控制器url
                                            data:{id:a},//做传递的参数
                                            success:function(data){//成功后执行的方法
                                                jQuery(t).parent().parent().parent().remove();//删除节点
                                                alert(data)
                                            },
                                            error:function(){//失败后执行的方法

                                            }
                                        })
                                    }

                                    $(document).ready($(function(){
                                        $.ajax({
                                            url:'/findAllLiuyan',
                                            type:'get',
                                            dataType:'json',
                                            success:function(data){
                                                //方法中传入的参数data为后台获取的数据
                                                $.each(data,function(index , obj)  //jquery的遍历json array的方式
                                                    {
                                                        var  tr;
                                                        var  tx;
                                                        var id = obj.id
                                                        tr =
                                                            '<td>'+obj.name+'</td>'+
                                                            '<td>'+obj.liuyan+'</td>'+
                                                            '<td>'+obj.reply+'</td>'





                                                        tx = '<td>\n' +
                                                            "<div class=\"tpl-table-black-operation\">\n" +
                                                            '<a href="javascript:;"  studentid = "' + id + '" onclick= "uploadscore(this)\">\n' +

                                                            '<i class= "am-icon-pencil"></i> 回复留言\n' +
                                                            "</a>\n" +

                                                            '<a href="javascript:;" studentid = "' + id +
                                                            '" onclick= "del(this)" class="tpl-table-black-operation-del">\n' +
                                                            "                                                            <i class=\"am-icon-trash\"></i> 删除留言\n" +
                                                            "                                                        </a>\n" +
                                                            "                                                    </div>\n" +
                                                            "                                                </td>"




                                                        if(yingcang()==1){
                                                            $("#tabletest").append('<tr class="even gradeC">'+tr +'</tr>')

                                                        }
                                                        else $("#tabletest").append('<tr class="even gradeC">'+tr + tx +'</tr>')

                                                    }
                                                )
                                            }
                                        })
                                    }))
                                </script>
                                <!--                                    <table width="100%" class="am-table am-table-compact am-table-bordered am-table-radius am-table-striped tpl-table-black " id="table">-->

                                <table  width="100%" class="am-table am-table-compact am-table-striped tpl-table-black ">
                                    <thead>
                                    <tr>
                                        <th>同学姓名</th>
                                        <th>留言内容</th>
                                        <th>老师回复</th>

                                    </tr>
                                    </thead>
                                    <tbody id="tabletest">

                                    <!-- more data -->
                                    </tbody>
                                </table>
                            </div>
                            <div class="am-u-lg-12 am-cf">

                                <div class="am-fr">
                                    <ul class="am-pagination tpl-pagination">
                                        <li class="am-disabled"><a href="#">«</a></li>
                                        <li class="am-active"><a href="#">1</a></li>
                                        <li><a href="#">2</a></li>
                                        <li><a href="#">3</a></li>
                                        <li><a href="#">4</a></li>
                                        <li><a href="#">5</a></li>
                                        <li><a href="#">»</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</div>
<script>
    function getCookie2(name){
        var strcookie = document.cookie;//获取cookie字符串
        var arrcookie = strcookie.split("; ");//分割
        //遍历匹配
        for ( var i = 0; i < arrcookie.length; i++) {
            var arr = arrcookie[i].split("=");
            if (arr[0] == name){
                return arr[1];
            }
        }
        return "";
    }

    function yingcang () {



        var id = getCookie2("id")
        $("#user-name-r").text(id)
        var user = getCookie2("user")
        if(user == "student"){

            // document.getElementById("yingcangdelete").style.display="none";
            $("#yingcang").hide()

            return 1

        }
        return 0
    }

</script>
<script>

    /**
     * 删除cookie
     * @param name cookie名字
     */
    function delCookie(name){
        var expires=new Date();
        expires.setTime(expires.getTime()-1);
        document.cookie=name+"="+name+";expires="+expires.toGMTString();
    }


    function quit(){

        sessionStorage.clear()
        delCookie("id")
        self.location.href = "/login"
    }



</script>
<script src="../static/assets/js/amazeui.min.js"></script>
<script src="../static/assets/js/app.js"></script>

</body>

</html>